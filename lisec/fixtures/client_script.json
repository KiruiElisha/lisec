[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lisec Integration Tool",
  "enabled": 1,
  "modified": "2024-12-07 13:32:13.564041",
  "module": "Lisec",
  "name": "Lisec",
  "script": "frappe.ui.form.on('Lisec Integration Tool', {\n\trefresh(frm) {\n\t\t// Clear and set up dashboard\n\t\tfrm.dashboard.clear_headline();\n\t\t\n\t\tfrm.add_custom_button('Get Lisec Data', () => {\n\t\t\tconsole.log(\"Getting Lisec Data\")\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'lisec.lisec.doctype.lisec_integration_tool.lisec_integration_tool.get_lisec_data',\n\t\t\t\targs: {\n\t\t\t\t\tlimit: 10,\n\t\t\t\t\toffset: 1,\n\t\t\t\t\tstart_date: frm.doc.from_date,\n\t\t\t\t\tend_date: frm.doc.to_date,\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: \"<h3 style='color: Yellow;'>Getting data from LISEC API.</h3>\",\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tif (r && r.message) {\n\t\t\t\t\t\tconsole.log(\"Lisec Data Response:\", r.message);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Update dashboard with response\n\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t`<div class=\"row\">\n\t\t\t\t\t\t\t\t<div class=\"col-xs-12\">\n\t\t\t\t\t\t\t\t\t<span class=\"indicator green\">\n\t\t\t\t\t\t\t\t\t\t${r.message}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Lisec Data Retrieved Successfully\"),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t}, 5);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: (r) => {\n\t\t\t\t\tconsole.error(\"Error getting Lisec data:\", r);\n\t\t\t\t\t\n\t\t\t\t\t// Show error in dashboard\n\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t`<div class=\"row\">\n\t\t\t\t\t\t\t<div class=\"col-xs-12\">\n\t\t\t\t\t\t\t\t<span class=\"indicator red\">\n\t\t\t\t\t\t\t\t\tError getting Lisec data: ${r.message || \"Unknown error\"}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Error getting Lisec data\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t});\n    \n\t\tfrm.add_custom_button(__('Create MR'),\n\t\t\tfunction() {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'lisec.lisec.doctype.lisec_integration_tool.lisec_integration_tool.main_manual',\n\t\t\t\t\targs: {\n\t\t\t\t\t\torder_id: frm.doc.order_id,\n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t\tfreeze_message: \"<h3 style='color: RoyalBlue;'>Creating Material Requests in ERPNext with Lisec API fetched order data.</h3>\",\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r && r.message) {\n\t\t\t\t\t\t\tconsole.log(\"Material Request Creation Response:\", r.message);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Update dashboard with response\n\t\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t\t`<div class=\"row\">\n\t\t\t\t\t\t\t\t\t<div class=\"col-xs-12\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"indicator green\">\n\t\t\t\t\t\t\t\t\t\t\t${r.message}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Material Request Created Successfully\"),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t}, 5);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\terror: (r) => {\n\t\t\t\t\t\tconsole.error(\"Error creating Material Request:\", r);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Show error in dashboard\n\t\t\t\t\t\tfrm.dashboard.set_headline_alert(\n\t\t\t\t\t\t\t`<div class=\"row\">\n\t\t\t\t\t\t\t\t<div class=\"col-xs-12\">\n\t\t\t\t\t\t\t\t\t<span class=\"indicator red\">\n\t\t\t\t\t\t\t\t\t\tError creating Material Request: ${r.message || \"Unknown error\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Error creating Material Request\"),\n\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t);\n\t},\n});",
  "view": "Form"
 }
]